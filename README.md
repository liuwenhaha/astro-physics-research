# astro-physics-research
Repo for my undergraduate thesis codes. This readme serves as a guide to run and work on my project.


## Project Directory  
* `.idea` is folder for PyCharm, you can ignore it.

* `/assets` includes `/explosure_831555_w2m0m0` and `/predictions`. 
    a) `/explosure_831555_w2m0m0` contains the original `.fits` & `.dat` files from Prof. Zhang's pipeline. 
    b) `/predictions` is deprecated.

* `/other` includes `/docs`, `/paper`, `/predictions`, `tensorflow_tutorial`, `Coding.ipynb` and something else.  
    a) `/docs` contains notes that tracks my studies and works in this project.  
    b) `/paper` contains plots in my paper.   
    c) `/predictions` contains the ellipticity-distribution-plots from methods in my paper(polynomial polynomial-with-sympy-inplementation & tensorflow-chipwise-interpolation). These `.png` are generated by running `psf_interpolation.py`. Try to get your own `.png` by following *Step 3* in **Instruction to Boot the Project** session. 
    d) `/tensorflow_tutorial` contains files I downloaded when studing **Tensorflow - Getting Started**, also in **Instruction to Boot the Project** session.  
    e) `Coding.ipynb` is the jupter-notebook to scratch and produce plots for my paper.  
    f) other files in this directory are not so relevant. You can ignore them.

* `psf_interpolation.py` is the main entrance for the projects. See descriptions in **Instruction to Boot the Project** session.

* `psf_interpolation_utils.py` collects many helper functions for my project. Such as:
    a) `write_predictions()`: Writes the predicted psf images to files.
    b) `get_ellipticity()`: Calculates ellipticity for psf image.
    c) `plot_stamp()`, `plot_exp_stamp_comparison()`, `plot_ellipticities()` etc...: Make some plots.
    d) etc..

* `poly_interpolation.py`, `poly_sym_interpolate.py`, tf_psfwise_chip_interpolation.py` and `tf_psfwise_interpolation.py` contain methods in my paper.  


## Instruction to Boot the Project

1. This project works under Python 3.X and runs on linux environment(probably on Windows as well, seems okay for me), so please install Python 3.X on your computer first.
   Download and install necessary software and libraries, including:  
   Python: `tensorflow` `scipy` `sympy` `matplotlib` `jupyter` (using `pip install <library name>`). There may be something that I forget here. Just use `pip install` anytime Python complaining a missing library.  
   PyCharm(highly recommended, you can get the education version for free, consult Hekun Lee for more helps)  
   
2. Get hands on some tutorials, so that you don't panic while reading my codes(also good for writing your own codes):  
   1) *Scipy Lecture Notes* [http://www.scipy-lectures.org/]: Session **1.1**, **1.2**, **1.3**, **1.4**, **3.2**  
   2) *Tensorflow - Getting Started* [https://www.tensorflow.org/get_started/]: Session **Getting Started with Tensorflow** **MNIST for ML Beginners** **Deep MNIST for Experts** **TensorFlow Mechanics 101** **TensorBoard: Visualizing Learning** **TensorBoard: Graph Visualization**  
   I am assuming you are familiar and comfortable with Python. If not so, please makeup for Python as well.

3. The door for all codes starts at `psf_interpolation.py`. You can go down to `if __name__ = '__main__':` and run the whole project from there. `my_psf` is the object such that(take the example of poly7, you can try like poly5, poly11)  
   1) `my_psf.interpolate(method='poly7')` interpolates using polynomial-7-order methods(get the polynomial coefficients)
   2) `my_psf.predict(method='poly7')` makes predictions using the above results(generate psf images using the above coefficients, save predicted psf images to files)   
   3) `my_psf.plot_ellipticities(method='poly7')` plots ellipticities distribution for the polynomial-7-order predicted-psf-images.   
   4) `my_psf.examine(method='poly7')` takes out the largest-ellipticity psf(in validate set) on each chip, and plot the polynomial-7-order predicted-psf-images and origin-psf-images together.   
   
   So you should successfully run: 
   ```
      # polynomial-7-order 
          my_psf.interpolate(method='poly7')
          my_psf.predict(method='poly7')
          my_psf.plot_ellipticities(method='poly7')
          my_psf.examine(method='poly7')

      # polynomial-7-order with sympy implementation
          my_psf.interpolate(method='poly_sym7')
          my_psf.predict(method='poly_sym7')
          my_psf.plot_ellipticities(method='poly_sym7')
          my_psf.examine(method='poly_sym7')
   ```
   Also for tensorflow you have:  
   ```
      # tensorflow chip-wisely interpolation (better method!)
          hidden1 = 36          # hidden1 has 36 nodes
          hidden2 = 144         # hidden2 has 144 nodes
          hidden3 = 576         # hidden3 has 576 nodes
          learning_rate = 0.1   # learning_rate is 0.1
          max_steps = 500       # max_steps is 500
          batch_size = 10       # batch_size is 10
          my_psf.interpolate(method='tf_psfwise_chip', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                             learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size)
          my_psf.predict(method='tf_psfwise_chip', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                         learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size, tag='train')
          my_psf.plot_ellipticities(method='tf_psfwise_chip', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                                    learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size)
          my_psf.examine(method='tf_psfwise_chip', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                         learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size)

      # tensorflow globally interpolation (not that good!)
          hidden1 = 36          # hidden1 has 36 nodes
          hidden2 = 144         # hidden2 has 144 nodes
          hidden3 = 576         # hidden3 has 576 nodes
          learning_rate = 0.1   # learning_rate is 0.1
          max_steps = 500       # max_steps is 500
          batch_size = 10       # batch_size is 10
          my_psf.interpolate(method='tf_psfwise', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                             learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size)
          my_psf.predict(method='tf_psfwise', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                         learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size, tag='train')
          my_psf.plot_ellipticities(method='tf_psfwise', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                                    learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size)
          my_psf.examine(method='tf_psfwise', hidden1=hidden1, hidden2=hidden2, hidden3=hidden3,
                         learning_rate=learning_rate, max_steps=max_steps, batch_size=batch_size)
   ```
   To plot the train/validate set distribution, you can use:  
   ```
          my_psf.plot_train_validate_dist()
   ```
   Note that, I re-structure my project by moving many files into `/other` directory. So there may be some problems with the import/export directories in my Python codes. Try to do some trouble-shooting yourself to fix it.(read the code and change the string for relative directory)

4. Read the code in `poly_interpolation.py` & `poly_sym_interpolate.py`. There are details for how I implemented polynomial interpolations in Python. Also refer to my paper if necessary.  

5. Read the code in `tf_psfwise_chip_interpolation.py` and `tf_psfwise_interpolation.py`.(The tf_pixelwise_interpolation.py was an incomplete implementation at that time, which runs endless time and has performance issue.) There are details for how I implemented tensorflow interpolations in Python. Note that, the former interpolates chip-wisely(which is the better one), while the latter interpolates globally.


## Tips for Cooking Your Paper

1. Time is limited, so please start early and update frequently with Prof. Zhang, Heku Lee, Wentao Luo & Fuyu Dong.(Get yourself some progresses every 3 days)  
2. I used to write Python codes on PyCharm, and make plots on Jupyter notebook. Before writing Python codes or making plots, try to first sketch on a paper, and understand what you are doing & what you want.  
3. For undergraduate thesis, participations and efforts outbeat other factors. Reasoning for your ideas, formatting your plots, choosing your words.  
4. Start the paper early, so that you can at least have something and make yourself relaxed.
